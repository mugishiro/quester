<!DOCTYPE html>
<html>
  <head>
    <%= display_meta_tags(default_meta_tags) %>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Quester</title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css">

    <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_include_tag 'application', 'data-turbolinks-track': 'reload' %>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.7.2/js/all.js"></script>
  </head>

  <body data-new-post-path="<%= new_user_post_path(current_user) if user_signed_in? %>">
    <div class="bg-white border-bottom header-sticky">
      <div class="container content-wrapper py-2">
        <%= render 'layouts/navbar' %>
      </div>
    </div>
    <div class="main py-5">
      <div class="container content-wrapper">
        <%= render 'layouts/flash_messages' %>
        <%= yield %>
      </div>
    </div>
    <% if user_signed_in? %>
      <script>
        (function () {
          var path = "<%= j new_user_post_path(current_user) %>";
          var btn = document.getElementById("floating-cta");
          if (!btn) {
            btn = document.createElement("a");
            btn.id = "floating-cta";
            btn.className = "floating-cta";
            btn.innerHTML = '<span class="floating-cta__icon">＋</span><span class="floating-cta__label">質問する</span>';
            document.body.appendChild(btn);
          }
          function toggle() {
            var isMobile = window.matchMedia("(max-width: 768px)").matches;
            var scrolled = window.pageYOffset > 120;
            if (isMobile || scrolled) {
              btn.href = path;
              btn.classList.add("is-visible");
            } else {
              btn.classList.remove("is-visible");
            }
          }
          ["load", "scroll", "resize"].forEach(function (ev) {
            window.addEventListener(ev, toggle);
          });
          document.addEventListener("turbolinks:load", toggle);
          toggle();
        })();
      </script>
    <% end %>
  </body>
</html>
