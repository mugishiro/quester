<div class="card-body">
  <%= form_with(model: reply, local: true, url: confirm_new_reply_path) do |f| %>
    <%= f.hidden_field :post_id, value: post.id %>
    <div class="js-text-wrapper">
      <%= f.text_area :content, class: 'form-control js-text', rows: 8, maxlength: 1000, style: "resize: none;" %>
      <div class="form-footer d-flex align-items-center justify-content-end mt-2">
        <span class="js-text-count text-muted small mr-2">0/1000</span>
        <%= f.submit '回答する', class: 'btn btn-info px-4 py-2' %>
      </div>
    </div>
  <% end %>
</div>
<script>
  (function () {
    var MAX = 1000;
    function bindCounters() {
      document.querySelectorAll('.js-text-wrapper').forEach(function (wrapper) {
        var area = wrapper.querySelector('.js-text');
        var counter = wrapper.querySelector('.js-text-count');
        if (!area || !counter) return;
        function tick() {
          var count = (area.value || '').replace(/\n/g, '改行').length;
          counter.textContent = count + '/' + MAX;
          counter.style.color = count > MAX ? 'red' : 'black';
        }
        ['input', 'change', 'keyup'].forEach(function (ev) {
          area.addEventListener(ev, tick);
        });
        tick();
      });
    }
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', bindCounters);
    } else {
      bindCounters();
    }
    document.addEventListener('turbolinks:load', bindCounters);
  })();
</script>
